(()=>{"use strict";var e="";function t(t){var o=document.querySelector(".popup_opened").querySelector(".popup__save");t?(e=o.textContent,o.textContent="Сохранение..."):setTimeout((function(){o.textContent=e}),500)}function o(){Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){n(e)}))}var n=function(e){var t=Array.from(e.querySelectorAll(".popup__edit")),o=e.querySelector(".popup__save");c(t,o),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__edit_error"),o.textContent=""}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__edit_error"),n.textContent=o}(e,t,t.validationMessage)}(e,n),c(t,o)}))}))},r=function(e){return e.some((function(e){return!e.validity.valid}))};function c(e,t){r(e)?(t.classList.add("popup__save_disabled"),t.setAttribute("disabled","disabled")):(t.classList.remove("popup__save_disabled"),t.removeAttribute("disabled"))}var i=document.querySelector(".popup_type_profile"),a=document.querySelector(".popup_type_avatar"),u=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__job"),p=document.getElementById("name-input"),s=document.getElementById("job-input"),_=document.getElementById("avatar-input");function f(e){e.target.classList.contains("popup_opened")&&h(document.querySelector(".popup_opened"))}function v(e){e.classList.add("popup_opened"),document.addEventListener("keydown",y),document.querySelector(".popup_opened").addEventListener("click",f)}function h(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",y),e.removeEventListener("click",f)}function y(e){"Escape"===e.key&&h(document.querySelector(".popup_opened"))}var m,S,g=document.querySelector(".profile__name"),q=document.querySelector(".profile__job"),b=document.querySelector(".profile__avatar");function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}var E=document.querySelector(".photo-grid__list"),L=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_type_card-form"),T=document.querySelector(".popup_type_delete"),j=document.getElementById("place-input"),x=document.getElementById("url-input"),w=L.querySelector(".popup__place-name"),A=L.querySelector(".popup__image"),P=document.getElementById("card").content.querySelector(".photo-grid__card");function z(e){var t=j.value,o=x.value,n=P.cloneNode(!0);return"object"===k(e)&&e.hasOwnProperty("likes")&&(n.querySelector(".photo-grid__likes").textContent=e.likes.length),e.owner._id!==m._id&&n.querySelector(".photo-grid__delete").remove(),function(e,t){var o=t.querySelector(".photo-grid__like");e.likes.find((function(e){return e._id===m._id}))?(o.classList.add("photo-grid__like_active"),o.addEventListener("click",O)):o.addEventListener("click",I)}(e,n),n.setAttribute("data-id",e._id),n.querySelector(".photo-grid__city").textContent=t,n.querySelector(".photo-grid__image").src=o,j.value="",x.value="",n.querySelector(".photo-grid__image").addEventListener("click",B),n.querySelector(".photo-grid__delete")&&n.querySelector(".photo-grid__delete").addEventListener("click",H),n}var D="";function H(e){D=e.target.closest(".photo-grid__card").getAttribute("data-id"),v(T)}function B(e){var t=e.target,o=t.closest(".photo-grid__card").querySelector(".photo-grid__city");w.textContent=o.textContent,A.src=t.src,v(L)}function I(e){var t=e.target.closest(".photo-grid__card"),o=t.getAttribute("data-id"),n=t.querySelector(".photo-grid__likes");fetch("https://nomoreparties.co/v1/wbf-cohort-6/cards/likes/".concat(o),{method:"put",headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522"}}).then((function(e){return e.ok||e.json().then((function(t){console.error("Ошибка HTTP: "+e.status,t)})),e.json()})).then((function(t){e.target.removeEventListener("click",I),e.target.classList.add("photo-grid__like_active"),n.textContent=t.likes.length,e.target.addEventListener("click",O)})).catch((function(e){console.error("Ошибка в функции likeCard:",e)}))}function O(e){var t=e.target.closest(".photo-grid__card"),o=t.getAttribute("data-id"),n=t.querySelector(".photo-grid__likes");fetch("https://nomoreparties.co/v1/wbf-cohort-6/cards/likes/".concat(o),{method:"DELETE",headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522"}}).then((function(e){return e.ok||e.json().then((function(t){console.error("Ошибка HTTP: "+e.status,t)})),e.json()})).then((function(t){e.target.removeEventListener("click",O),e.target.classList.remove("photo-grid__like_active"),n.textContent=t.likes.length,e.target.addEventListener("click",I)})).catch((function(e){console.error("Ошибка в функции likeCard:",e)}))}var N=document.querySelector(".popup_type_profile"),J=document.querySelector(".popup_type_card-form"),M=document.querySelector(".popup_type_image"),F=document.querySelector(".popup_type_avatar"),G=document.querySelector(".popup_type_delete"),K=F.querySelector(".popup__save"),Q=J.querySelector(".popup__save"),R=N.querySelector(".popup__save"),U=N.querySelector(".popup__close"),V=J.querySelector(".popup__close"),W=document.querySelector(".profile__edit"),X=document.querySelector(".profile__button"),Y=M.querySelector(".popup__close"),Z=document.querySelector(".profile__avatar-overlay"),$=F.querySelector(".popup__close"),ee=G.querySelector(".popup__close"),te=G.querySelector(".popup__save");ee.addEventListener("click",(function(){h(G)})),$.addEventListener("click",(function(){h(F)})),Z.addEventListener("click",(function(){v(F)})),W.addEventListener("click",(function(){v(N)})),X.addEventListener("click",(function(){v(J)})),U.addEventListener("click",(function(){h(N)})),V.addEventListener("click",(function(){h(J)})),Y.addEventListener("click",(function(){h(M)})),R.addEventListener("click",(function(e){e.preventDefault(),t(!0);var o=p.value,n=s.value;fetch("https://nomoreparties.co/v1/wbf-cohort-6/users/me",{method:"PATCH",headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522","Content-Type":"application/json"},body:JSON.stringify({name:p.value,about:s.value})}).then((function(e){e.ok?(l.textContent=o,d.textContent=n):e.json().then((function(t){console.error("Ошибка HTTP: "+e.status,t)}))})).catch((function(e){console.error("Ошибка запроса:",e)})).finally((function(){t(!1),h(i)}))})),Q.addEventListener("click",(function(e){e.preventDefault(),t(!0),fetch("https://nomoreparties.co/v1/wbf-cohort-6/cards",{method:"POST",headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522","Content-Type":"application/json"},body:JSON.stringify({name:j.value,link:x.value})}).then((function(e){e.ok?e.json().then((function(e){var t=z(e);E.prepend(t)})):e.json().then((function(t){console.error("Ошибка HTTP: "+e.status,t)}))})).catch((function(e){console.error("Ошибка запроса:",e)})).finally((function(){t(!1),h(C),o()}))})),K.addEventListener("click",(function(e){e.preventDefault(),t(!0),fetch("https://nomoreparties.co/v1/wbf-cohort-6/users/me/avatar",{method:"PATCH",headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522","Content-Type":"application/json"},body:JSON.stringify({avatar:_.value})}).then((function(e){e.ok?(u.link=_.value,_.value=""):e.json().then((function(t){console.error("Ошибка HTTP: "+e.status,t)}))})).catch((function(e){console.error("Ошибка запроса:",e)})).finally((function(){t(!1),h(a),o()}))})),te.addEventListener("click",(function(e){e.preventDefault(),function(e){fetch("https://nomoreparties.co/v1/wbf-cohort-6/cards/".concat(e),{method:"DELETE",headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522"}}).then((function(e){return e.ok||e.json().then((function(t){console.error("Ошибка HTTP: "+e.status,t)})),e.json()})).then((function(){document.querySelector('[data-id="'.concat(e,'"]')).remove()})).catch((function(e){console.error("Ошибка в функции deleteCard:",e)}))}(D),h(T)})),o(),fetch("https://nomoreparties.co/v1/wbf-cohort-6/users/me",{headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522"}}).then((function(e){if(!e.ok)throw new Error("Ошибка получения данных: ".concat(e.statusText));return e.json()})).then((function(e){m=e})).then((function(){g.textContent=m.name,q.textContent=m.about,b.src=m.avatar,p.value=l.textContent,s.value=d.textContent})).then((function(){fetch("https://nomoreparties.co/v1/wbf-cohort-6/cards",{headers:{authorization:"54974c2d-ab71-4b56-9932-c842ca70e522"}}).then((function(e){if(!e.ok)throw new Error("Ошибка получения данных: ".concat(e.statusText));return e.json()})).then((function(e){S=e})).then((function(){S.forEach((function(e){j.value=e.name,x.value=e.link;var t=z(e);E.prepend(t)}))})).catch((function(e){console.error("Ошибка в функции getDataProfile:",e)}))})).catch((function(e){console.error("Ошибка в функции getDataProfile:",e)}))})();